<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Theme on gomlog</title>
    <link>http://gomlog.com/tags/theme/index.xml</link>
    <description>Recent content in Theme on gomlog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <copyright>gomlog.com</copyright>
    <atom:link href="http://gomlog.com/tags/theme/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>wordpress--K2は悪くなかっ･･･た？</title>
      <link>http://gomlog.com/20070605_sorry_k2</link>
      <pubDate>Tue, 05 Jun 2007 00:00:00 +0000</pubDate>
      
      <guid>http://gomlog.com/20070605_sorry_k2</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://gomlog.com/2007/05/29/k2_no_bad/&#34;&gt;前回のエントリ&lt;/a&gt;の続きです。
表示されていなかったK2ライブアーカイブ機能を復活させました。バージョンアップが原因なのか、はたまた・・・
以下、詳細。
&lt;/p&gt;

&lt;p&gt;まずは環境。
Apache  1.3.37
PHP 5.1.6
MySQL   5.1.11&lt;/p&gt;

&lt;p&gt;Wordpress ME2.1.2&lt;/p&gt;

&lt;h2 id=&#34;k2-0-95-rc1&#34;&gt;K2 0.95 RC1&lt;/h2&gt;

&lt;p&gt;さて、まずはヘッダーのメニューに表示されない原因を探ってみます。
K2のオプションからライブアーカイブ機能をONにすると、自動的にPageが生成されます。
このPageがヘッダに表示されるわけです。てことは、単純にこのPageが消えてるわけですね。さっぱりと。&lt;/p&gt;

&lt;p&gt;とは言っても消した覚えなんぞとんとありません。
納得いかないながらも、復旧作業に入ります。
まずは、オプションでライブアーカイブ機能をONにしたときに生成されるレコードを調べます。
アーカイブページ生成時に、PageのIDを下記のようにして取得しているようです。&lt;/p&gt;

&lt;p&gt;&lt;cite&gt;k2/app/archive.php&lt;/cite&gt;
&lt;code&gt;
$archives_id = $wpdb-&amp;gt;get_var(&amp;ldquo;SELECT post_id FROM $wpdb-&amp;gt;postmeta
 WHERE meta_key = &amp;lsquo;_wp_page_template&amp;rsquo; AND meta_value = &amp;lsquo;page-archives.php&amp;rsquo; LIMIT 1&amp;rdquo;);
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;てことは、WHEREにある
&lt;code&gt;meta_key = &amp;lsquo;_wp_page_template&amp;rsquo; AND meta_value = &amp;lsquo;page-archives.php&amp;rsquo;&lt;/code&gt;
というレコードが必要ってことですね。てことで、postmetaテーブルを検索～
・・・ない。全く見あたらない。またしても消えている。
仕方ない、同じようなレコードを追加しておこう。&lt;/p&gt;

&lt;p&gt;次はPage生成をしているようだ。
上記のIDの他に値を入れ込むコードが続き、最後にpostテーブルに追加を行っている。
postテーブルで似たようなデータを検索・・・やっぱり、ない。
上でも言っているように、Page本体がいなくなっていることが明らかになりました。
postmetaテーブルの必要なレコードがなんらかの原因で消えてしまい、Pageの生成が行われてなかったんですね。
手動でPageを追加し、様子を見てみる。&lt;/p&gt;

&lt;p&gt;ヘッダにArchiveの文字が表示。だが・・・リンク先は404エラー。&lt;/p&gt;

&lt;h2 id=&#34;管理メニューからpageを再保存してみる-今度は表示されました&#34;&gt;管理メニューからPageを再保存してみる。今度は表示されました。&lt;/h2&gt;

&lt;p&gt;さて、ここからが謎というか、本当の原因かもしれません。
Archiveの復活に調子を良くし、高機能ナビゲーションも復活させようとしました。
K2＞オプション&amp;gt;高機能ナビゲーションON&lt;/p&gt;

&lt;p&gt;うーん、JSのエラーが出るなぁ・・・と思ったその時！
&lt;strong&gt;Archiveが消えてる！！！&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;なんじゃそりゃああああってんで、データベースを確認しにいくと・・・
先ほど作成したpostテーブルのPageデータがめちゃくちゃになってました。
ステータスはおかしくなってるわ、タイトルは日本語？になってるわ・・・
高機能ナビゲーションをONにした影響なのでしょうか。ME2.1.2の影響なのでしょうか。
ここら辺で調べるのが面倒になってきたので、Pageを修復して終了。&lt;/p&gt;

&lt;p&gt;Wordpressのテーマ、K2は確かに便利ですが、多くのプラグインが内蔵されています。WP自体をバージョンアップすると、
内蔵プラグインにも影響が出ることもあるのでしょう。
今後は予備のテーマを一つ用意しておいた方がよさそうですね。&lt;/p&gt;

&lt;p&gt;&lt;cite&gt;&amp;gt;&amp;gt;Extended Live Archives:
&lt;a href=&#34;http://www.sonsofskadi.net/extended-live-archive/&#34;&gt;http://www.sonsofskadi.net/extended-live-archive/&lt;/a&gt;&lt;/cite&gt;&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>